<nav class="navbar navbar-inverse navbar-custom">
    <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <a class="navbar-brand header__logo" href="{{ baseurl }}/">
              <img class="header__logo_img" src="/images/transparent_logo_128.png" />
              <img class="header__logo_text" src="/images/logo_text.svg" />
            </a>
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span> <i class="fa fa-2x fa-bars"></i>
            </button>
        </div>

        <form class="navbar-form navbar-left header__search_wrap hidden-sm" id="header__search">
          <div class="form-group">
            <input id="header__search_input"
                   type="text"
                   class="form-control header__search_input"
                   placeholder="{{ site.data[page.language].strings.search }}"
                   />
          </div>

          <script type="text/javascript">
            function closeSearch() {
              document.getElementsByTagName('body')[0].classList.remove('body_fixed');
              document.getElementById('search').style.display = 'none';
              var header = document.getElementById('header');
              if (header) {
                header.style.display = 'block';
              }
              document.getElementsByClassName('smoke')[0].classList.remove('smoke--fullscreen');
              document.getElementsByClassName('navbar')[0].classList.remove('navbar--fixed');
            }

            function openSearch(search) {
              document.getElementById('header__search_input').value = search;
              document.getElementById('header__search_input').focus();
              startSearch(search);
            }

            function startSearch(search) {
              // Try to get roots from server
              Mydataspace.request('entities.getRoots', {
                search: search
              }, function(data) {
                var rootsHtml = data.roots.map(function(root) {
                  var avatar = MDSCommon.findValueByName(root.fields, 'avatar');
                  if (MDSCommon.isBlank(avatar)) {
                    avatar = '/images/icons/root.svg';
                  } else {
                    avatar = 'https://cdn.mydataspace.net/avatars/sm/' + avatar + '.png';
                  }
                  return '<div class="col-md-4"><a class="snippet clearfix" href="/' + root.root + '">\n' +
                    '  <div class="snippet__overview">\n' +

                    '  <img class="snippet__image" src="' + avatar + '" />\n' +
                    '  <div class="snippet__info">\n' +
                    '    <div class="snippet__title">' + (MDSCommon.findValueByName(root.fields, 'name') || root.root) + '</div>\n' +
                    '    <div class="snippet__tags">' + (MDSCommon.findValueByName(root.fields, 'tags') || '') + '</div>\n' +
                    '</div>\n' + // info

                    '</div>\n' + // overview
                    '  <div class="snippet__description">' + (MDSCommon.findValueByName(root.fields, 'description') || '') + '</div>\n' +
                    '</a></div>';
                });
                document.getElementById("search").innerHTML =
                  rootsHtml.length > 0 ? '<div class="container search__content"><div class="row">' + rootsHtml.join('\n') + '</div></div>' : "WTF????";
              }, function(err) {
                console.log(err);
              });
            }

            document.getElementById('header__search_input').addEventListener('focus', function() {
              document.getElementsByTagName('body')[0].classList.add('body_fixed');
              document.getElementById('search').style.display = 'block';
              var header = document.getElementById('header');
              if (header) {
                header.style.display = 'none';
              }
              document.getElementsByClassName('smoke')[0].classList.add('smoke--fullscreen');
              document.getElementsByClassName('navbar')[0].classList.add('navbar--fixed');
              startSearch('');
            });

            document.getElementById('header__search_input').addEventListener('keyup', function(event) {
              if (event.keyCode === 27) {
                closeSearch();
                document.getElementById('header__search_input').blur();
                return;
              }
              startSearch(document.getElementById('header__search_input').value);
            }, false);
          </script>
        </form>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li class="hidden">
                    <a href="#page-top"></a>
                </li>
                <li>
                    <a href="{{ baseurl }}/get-started">{{ site.data[page.language].menu.get_started }}</a>
                </li>
                <li>
                    <a href="{{ baseurl }}/demos">{{ site.data[page.language].menu.demos }}</a>
                </li>
                <li>
                    <a href="{{ baseurl }}/docs">{{ site.data[page.language].menu.docs }}</a>
                </li>
                <li>
                {% if page.url != "/404.html" %}
                  <ul class="header__languages">
                  <li class="header__language">
                    {% if page.language == site.default_language %}
                      {% assign url = page.url %}
                    {% else %}
                      {% assign page_lang = page.language | prepend:'/' | append:'/' %}
                      {% assign url = page.url | replace_first:page_lang,"/" %}
                    {% endif %}
                    {% if site.default_language == page.language %}
                    <a class="header__language_button header__language_button--active" href="{{ url }}">{{ site.default_language | upcase }}</a>
                    {% else %}
                    <a class="header__language_button" href="{{ url }}">{{ site.default_language | upcase }}</a>
                    {% endif %}
                  </li>
                  {% for lang in site.languages %}
                    <li class="header__language">
                      {% assign page_lang = page.language | prepend:'/' | append:'/' %}
                      {% assign curr_lang = lang | prepend:'/' | append:'/' %}

                      {% if lang == page.language %}
                        {% assign url = page.url %}
                      {% elsif page.language == site.default_language %}
                        {% assign url = page.url | prepend:lang | prepend:'/' %}
                      {% else %}
                        {% assign url = page.url | replace_first:page_lang,curr_lang %}
                      {% endif %}

                      {% if lang == page.language %}
                        <a class="header__language_button header__language_button--active" href="{{ url }}">
                          {{ lang | upcase }}
                        </a>
                      {% else %}
                        <a class="header__language_button" href="{{ url }}">
                          {{ lang | upcase }}
                        </a>
                      {% endif %}
                    </li>
                  {% endfor %}
                  </ul>
                {% endif %}
                </li>
                {% if page.url != baseurl_with_trailing_slash %}
                <li id="profile_button_menu_item">
                  <script>
                    if (isValidJWT(localStorage.getItem('authToken'))) {
                      document.getElementById('profile_button_menu_item').style.display = 'block';
                    }
                  </script>
                  <a id="profile_button" class="profile_button" href="{{ baseurl }}/"></a>
                </li>
                <li id="login_button_menu_item">
                  <script>
                    if (isValidJWT(localStorage.getItem('authToken'))) {
                      document.getElementById('login_button_menu_item').style.display = 'none';
                    }
                  </script>
                  <button id="login_button"
                          class="login_button btn btn-default"
                          data-toggle="modal"
                          data-target="#signin_modal">
                  {{ site.data[page.language].menu.login }}
                  </button>
                </li>
                {% endif %}
            </ul>
        </div>
    </div>
</nav>

<div id="search" class="search">
</div>