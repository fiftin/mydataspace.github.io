---
layout: default
language: en
---
<div id="view" class="root_page" style="padding-bottom: 30px">
</div>

<script src="/vendor/remarkable.js"></script>

<script>
  (function() {

    var md = new Remarkable({
      html:         true,        // Enable HTML tags in source
      xhtmlOut:     false,        // Use '/' to close single tags (<br />)
      breaks:       false,        // Convert '\n' in paragraphs into <br>
      langPrefix:   'language-',  // CSS language prefix for fenced blocks
      linkify:      false,        // Autoconvert URL-like text to links

      // Enable some language-neutral replacement + quotes beautification
      typographer:  false,

      // Double + single quotes replacement pairs, when typographer enabled,
      // and smartquotes on. Set doubles to '«»' for Russian, '„“' for German.
      quotes: '“”‘’',

      // Highlighter function. Should return escaped HTML,
      // or '' if the source string is not changed
      highlight: function (/*str, lang*/) { return ''; }
    });


    var regex = new RegExp(".*/([^?#]+)"),
      results = regex.exec(location.href);
    if (!results) {
      return;
    }

    var data = {
      root: results[1],
      path: ''
    };

    var TABS = {
      VIEW_TAB_README_LABEL: 'view__about',
      VIEW_TAB_VIEW_LABEL: 'view__view',
      VIEW_TAB_COMMENTS_LABEL: 'view__comments'
    };

    function initTabs() {
      for (var tabID in TABS) {
        (function(tabID) {
          var tab = document.getElementById(tabID);
          tab.addEventListener('click', function(event) {
            for (var tid in TABS) {
              document.getElementById(tid).classList.remove('view__tab--active');
              document.getElementById(TABS[tid]).style.display = 'none';
            }
            tab.classList.add('view__tab--active');
            document.getElementById(TABS[tabID]).style.display = 'block';
            event.preventDefault();
          });
        })(tabID);
      }
    }

    function setRootView(data) {
      $.ajax({ url: '/fragments/root-view.html', method: 'get' }).then(function(html) {
        var view = document.getElementById('view');
        var websiteURL = data.fields.websiteURL;
        var description = data.fields.description;
        var readme = data.fields.readme;
        var ava = data.fields.avatar;

        view.innerHTML = html;

        if (MDSCommon.isPresent(ava)) {
          ava = Mydataspace.options.apiURL + '/avatars/sm/' + ava + '.png';
        }
        document.getElementById('view__overview_image').src = ava || '/images/icons/root.svg';
        document.getElementById('view__title').innerText =
          data.fields.name || MDSCommon.getPathName(data.root);

        var tags = (data.fields.tags || '').split(' ').filter(function(tag) {
          return tag != null && tag != '';
        }).map(function(tag) {
          return '<a class="view__tag" href="/?q=' + tag + '" onclick="openSearch(\'' + tag + '\'); return false;">' + tag + '</a>';
        }).join(' ');

        document.getElementById('view__tags').innerHTML = tags || '';
        document.getElementById('view__data_link').href = '/#' + data.root;
        document.getElementById('view__data_link').classList.remove('hidden');

        if (tags && websiteURL) {
          document.getElementsByClassName('view__overview_image_wrap')[0].classList.add('view__overview_image_wrap--large');
          document.getElementById('view__overview_image').classList.add('view__overview_image--large');
        } else if (tags || websiteURL) {
          document.getElementsByClassName('view__overview_image_wrap')[0].classList.add('view__overview_image_wrap--medium');
          document.getElementById('view__overview_image').classList.add('view__overview_image--medium');
        }

        if (MDSCommon.isBlank(websiteURL)) {
          document.getElementById('view__websiteURL').style.display = 'none';
        } else {
          document.getElementById('view__websiteURL').style.display = 'block';
          document.getElementById('view__websiteURL').innerText = websiteURL;
          document.getElementById('view__websiteURL').href = websiteURL;
        }

        if (MDSCommon.isBlank(description)) {
          if (MDSCommon.isBlank(readme)) {
            document.getElementById('view__description').innerHTML = '<center><i>' + STRINGS.NO_README + '</i></center>';
          } else {
            document.getElementById('view__description').style.display = 'none';
          }
        } else {
          document.getElementById('view__description').innerText = description;
        }

        if (MDSCommon.isBlank(readme)) {
          document.getElementById('view__readme').style.display = 'none';
        } else {
          document.getElementById('view__readme').style.display = 'block';
        }
        document.getElementById('view__readme').innerHTML = md.render(readme);

        initTabs();
      });
    }

    return Mydataspace.entities.request('entities.get', data).then(function(root) {
      setRootView(root);
    });
  })();
</script>