<!DOCTYPE html>
<html>

  {% include head.html webix=true %}

  <body>
    <div id="bootstrap" class="landing landing--{{ page.language }}">
      <script type="text/javascript">
        if (isValidJWT(localStorage.getItem('authToken')) ||
            window.location.hash != null && window.location.hash !== '' && window.location.hash !== '#') {
          document.getElementById('bootstrap').style.display = 'none';
        }
      </script>

      <div class="page_top">
        <div class="smoke">
          {% include nav.html %}
          {% include header.html %}
        </div>
      </div>

      <div class="mission">
        <div class="container">{{ site.data[page.language].mission }}</div>
      </div>

      {% include feature_sections.html %}
      {% include sub_footer.html %}
      {% include footer.html %}
    </div>

    {% include signin_modal.html %}

    <div id="webix">
      <script type="text/javascript">
        if (!isValidJWT(localStorage.getItem('authToken')) &&
            !(window.location.hash != null && window.location.hash !== '' && window.location.hash !== '#')) {
          document.getElementById('webix').style.display = 'none';
        }
      </script>
      <div class="webix_preloaded_header"></div>
      <div id="admin_panel__loading"><i class="fa fa-cog fa-spin fa-5x fa-fw"></i></div>
      <div class="logo" onclick="UI.pages.setCurrentPage('data');">
        <div class="logo__img_wrap">
          <img src="/images/logo_128.png" class="logo__img" />
        </div>
        <img src="/images/logo_text.svg" class="logo__text_img hidden-xs" />
      </div>
      <div id="no_items" class="no_items"></div>
      <div id="admin_panel" class="admin_panel"></div>
    </div>

    <script src="/vendor/jquery.min.js"></script>
    <script type="text/javascript">
      setTimeout(function() {
        $('#admin_panel__loading').remove();
      }, 1500);
    </script>
    <script src="/js/dist/api.js" type="text/javascript"></script>

    <script src="/vendor/bootstrap/bootstrap.min.js"></script>
    <script src="/vendor/webix/webix_debug.js"></script>
    <script src="/skins/flat/skin.js"></script>
    <script src="/vendor/remarkable.js"></script>
    <script src="/js/dist/ui.js"></script>
    <script>
      $(function() {
        $("#sub_footer__botton").popover({
          placement: 'top',
          html : true,
          trigger: 'focus',
          content: function() {
            return $("#signin_popover").html();
          }
        });
      });

      $(window).on('hashchange', function() {
        var isEmptyHash = window.location.hash == null ||
                          window.location.hash === '' ||
                          window.location.hash === '#';
        if (!isEmptyHash && document.getElementById('webix').style.display == 'none') {
          document.getElementById('bootstrap').style.display = 'none';
          document.getElementById('webix').style.display = 'block';
        };
      });

      webix.codebase = "/vendor/";
      Mydataspace = new Myda({
        apiURL: '{{ api_url }}',
        websocketURL: '{{ api_websocket_url }}',
        clientId: '{{ client_id }}',
        permission: 'admin',
        simpleFormat: false,
        connected: function() {
          UI.initConnection();
          if (isValidJWT(localStorage.getItem('authToken'))) {
              UI.refresh();
          }
        }
      });
      Mydataspace.authProviders.facebook.title = STRINGS.CONNECT_TO_FACEBOOK;
      Mydataspace.authProviders.google.title = STRINGS.CONNECT_TO_GOOGLE;
      UI.render('admin_panel');
      Mydataspace.connect();

      var md = new Remarkable({
        html:         true,        // Enable HTML tags in source
        xhtmlOut:     false,        // Use '/' to close single tags (<br />)
        breaks:       false,        // Convert '\n' in paragraphs into <br>
        langPrefix:   'language-',  // CSS language prefix for fenced blocks
        linkify:      false,        // Autoconvert URL-like text to links

        // Enable some language-neutral replacement + quotes beautification
        typographer:  false,

        // Double + single quotes replacement pairs, when typographer enabled,
        // and smartquotes on. Set doubles to '«»' for Russian, '„“' for German.
        quotes: '“”‘’',

        // Highlighter function. Should return escaped HTML,
        // or '' if the source string is not changed
        highlight: function (/*str, lang*/) { return ''; }
      });

    </script>
  </body>
</html>
